<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <!-- スマホで見やすくする設定 -->
  <meta name="viewport" content="width=device-width,initial-scale=1">

<!-- ブラウザのタブに表示されるタイトル -->
<title>お絵描き</title>
</head>
 
<body>
<canvas id='canvas' width='300' height='400'></canvas>  <!-- 絵を描くcanvas要素 -->

<script>

var touching = false;                                   // タッチ中か否かを入れる変数
var motionData = [];
var startX  = 100;                                        // 開始位置のX座標
var startY  = 100;                                        // 開始位置のY座標
var endX  = 100;                                          // 終了位置のX座標
var endY  = 100;                                          // 終了位置のY座標
var penColor = "#000000";                               // 線の色（#RRGGBB）
var penWidth = 5;                                       // 線の幅

// canvas要素に描画するためのお決まりの2行
var canvas  = document.getElementById("canvas");        // canvas 要素の取得
var context = canvas.getContext("2d");                  // 描画用部品を取得

if( window.DeviceMotionEvent ){ 
    window.addEventListener( "devicemotion", deviceMotion ); 
} 

function deviceMotion( e ){ 
  e.preventDefault(); 
  if( touching ){ 
    // 重力加速度を除いた加速度
    var ac = e.acceleration; 
    
    var motion = {}; 
    motion['ac'] = ac; 

    motionData.push( motion ); 
  } 
}

// タッチ開始イベントが起きたら
canvas.addEventListener("touchstart", (e) => {
    touching = true;                                    // タッチ中にする
    motionData = [];
});
 
// タッチ終了イベントが起きたら
canvas.addEventListener("touchend", (e) => {
    touching = false;
    if( motionData && motionData.length > 0 ){
      for( var i = 0; i < motionData.length; i ++ ){ 
        var mot = motionData[i]; 
        endX = endX + mot['ac'].x;
        endY = endY + mot['ac'].y;
        // 描画スタイルの設定
        context.strokeStyle = penColor;                 // 線の色
        context.lineWidth = penWidth;                   // 線の幅
        context.lineCap = "round";                      // 線の端を丸める
        // 開始座標から終了座標に向かって線を引く
        context.beginPath();                            // 描画開始
        context.moveTo(startX, startY);                 // 開始座標から
        context.lineTo(endX, endY);                     // 終了座標に向けて
        context.stroke();                               // 線を引く
        // 今の終了座標を次の開始座標にする
        startX = endX;
        startY = endY;
      } 
    }
});

</script>
</body>
</html>
